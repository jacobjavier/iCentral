<!DOCTYPE html>
<html>
<head>
    <title>Portal de Cliente</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h1 class="card-title">Portal de Cliente</h1>
                        <div class="form-group">
                            <label for="username">Nombre de usuario:</label>
                            <input type="text" class="form-control" id="username" placeholder="Ingresa tu nombre de usuario">
                        </div>
                        <div class="form-group">
                            <label for="password">Contraseña:</label>
                            <input type="password" class="form-control" id="password" placeholder="Ingresa tu contraseña">
                        </div>
                        <button class="btn btn-primary" id="loginButton">Iniciar sesión</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card" style="display: none;" id="services">
                    <div class="card-body">
                        <h2 class="card-title">Servicios</h2>
                        <ul class="list-group" id="servicesList"></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const loginButton = document.getElementById('loginButton');
        const servicesDiv = document.getElementById('services');
        const servicesList = document.getElementById('servicesList');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');

        loginButton.addEventListener('click', async () => {
            const username = usernameInput.value;
            const password = passwordInput.value;

            try {
                const user = await authenticateUser(username, password);
                if (user) {
                    const service = await getUserService(user.userId);
                    displayServices(service);
                } else {
                    alert('La autenticación falló.');
                }
            } catch (error) {
                console.error(error.message);
            }
        });

        const authenticateUser = async (username, password) => {
            try {
                const response = await axios.post('/auth/authenticate', {
                    username: username,
                    password: password
                });

                return response.data;
            } catch (error) {
                console.error(error.message);
            }
        };

        const getUserService = async (userId) => {
            try {
                const response = await axios.get(`/services/getservices/${userId}`);
                return response.data;
            } catch (error) {
                console.error(error.message);
            }
        };

        const displayServices = (service) => {
            if (service && service.services) {
                servicesList.innerHTML = '';
                service.services.forEach((item) => {
                    const listItem = document.createElement('li');
                    listItem.textContent = item.name;
                    servicesList.appendChild(listItem);
                });
                servicesDiv.style.display = 'block';
            }
        };
    </script>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
